(function (doc, i, list, length, p, noscript, content) { list = doc.getElementsByTagName('noscript'); p = doc.createElement('p'); for (length = list.length; i < length; i++) { noscript = list[i]; content = noscript.textContent || ''; if (/\s*<link\s/.test(content)) { p.innerHTML = content; while (p.childNodes.length) { noscript.parentNode.insertBefore(p.childNodes[0], noscript) } } } })(document, 0); (function () { var div = document.createElement('div'); div.innerHTML = '<!--[if lt IE 9]><i></i><![endif]-->'; var old = !!div.getElementsByTagName('i')[0]; var ver = '3.6.0'; require.config({ baseUrl: (_req.base || '') + 'js',urlArgs: 'ver=3.6', paths: { jquery: ['jquery-' + ver + '.min', '//ajax.googleapis.com/ajax/libs/jquery/' + ver + '/jquery.min'], mustache: ['mustache.min'], colorbox: ['jquery.colorbox.min'], owlcarousel: ['owl.carousel.min'], 'jquery-typeahead': ['jquery.typeahead.min'], velocity: ['velocity.min', '//cdn.jsdelivr.net/velocity/1.2.3/velocity.min'], 'velocity-ui': ['velocity.ui.min', '//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min'], iframeResizer: ['iframeResizer.min'], accordion: ['1644110403@accordion.min'], wizard: ['1644081603@wizard.min'], 'suggest-action': ['1644081603@suggest-action.min'], 'twca-wrap': ['1451011713@twca-wrap.min'], 'twcaCryptoLib': ['twca/1451011713@twcaCryptoLib'] }, shim: { 'iframeResizer': ['jquery'], 'typeahead': ['jquery'] } }); require(['jquery'], function () { var w = window; var _req = w._req || []; w._req = { push: function (o) { require.apply(w, o) }, base: _req.base, mode: _req.mode, defaultMsg: '伺服器忙碌中，請稍後再試。' }; $.loading = function (show) { show = typeof (show) === 'undefined' ? true : !!show; var $loading = $('#loading'); if (!$loading.length) { if (show) { $loading = $('<div id="loading"><div class="loader"></div></div>'); $$(function () { $loading.appendTo('body') }) } } return $loading.toggle(show) }; $.loading.visible = function () { return $('#loading').is(':visible') }; $.loading.show = function () { $.loading(true) }; $.loading.hide = function () { $.loading(false) }; $.delay = function (ms, data) { var def = $.Deferred(); setTimeout(function () { def.resolve(data) }, ms); return def.promise() }; $.wait = function (ms, defer) { var def = $.Deferred(); $.when($.delay(ms), defer).done(function (n, data) { def.resolve.apply(this, data) }); return def.promise() }; $(window).bind("pageshow", function (e) { if (!e.originalEvent.persisted) { return } $.loading.hide() }); $.defaultTypeaheadOption = { minLength: 1, maxItem: 60, display: ['id', 'name'], cache: 'localStorage', source: { url: _req.base + 'api/stock.ashx' }, matcher: function (item, displayKey) { if (!/^[a-z0-9]$/i.test(this.query)) { return true } } }; $(document).on('cbox_complete', function () { $('body').css('overflow', 'hidden'); $('#colorbox').css({ 'overflow-y': 'auto' }) }).on('cbox_cleanup', function () { $('body').css('overflow', 'inherit') }); $.each(_req, function (i, o) { require.apply(window, o) }); $$(function () { var frms = $('form.waiting'); if (frms.length && typeof (Page_IsValid) !== 'undefined') { frms.submit(function (e) { if (!Page_IsValid) { return } if ($.loading.visible()) { e.preventDefault(); return false } $.loading.show() }) } var gotop = $('.gotop').on('click', function () { $('html,body').animate({ scrollTop: 0 }, 500) }); $(window).scroll(function () { var wH = $(this).height(); var wrapH = $('#wrap').height(); var fH = $('footer').innerHeight(); var scrollPos = $(this).scrollTop(); var topPos = wrapH - wH - fH + $(this).width() * 0.0625; var bottomPos = scrollPos - topPos; gotop.stop()[scrollPos > 200 ? 'fadeIn' : 'fadeOut']().css('bottom', bottomPos < 0 ? '6.25vw' : 'calc(6.25vw + ' + bottomPos + 'px)') }).resize(function () { $(this).scroll() }); $('input:password').after($('<span class="icon-eye close">').click($.noop)); $('body').on('click', '.icon-eye', function () { var me = $(this); var target = me.prev(); if (target.prop('disabled')) { return } var b = me.toggleClass('close').hasClass('close'); target.attr('type', b ? 'password' : 'text') }); var $wrap = $('#wrap'); var $header = $('header').children('a.menu').on('click', function () { $('body').addClass('switch'); $wrap.off('touchmove').on('touchmove', function (e) { e.target !== this || e.preventDefault() }).off('click').on('click', function (e) { e.target !== this || $(this).find('header nav a.menu').click() }) }).end().children('nav').on('click', 'a.menu', function () { $wrap.off('click').off('touchmove'); $('body').removeClass('switch') }).end().on('click', '.sublist a', function () { $(this).toggleClass('open').next('ul').slideToggle() }); $('.logout').on('click', function () { var frm = $('<form method="post" />').attr('action', _req.base + 'logout.aspx' || $(this).data('href')).appendTo('body'); setTimeout(function () { frm.submit() }, 200) }); $('.accordion .mobile-order').on('click', 'a.install', function () { var ua = navigator.userAgent; if (/iphone|ipad/i.test(ua)) { this.href = $(this).data('ios') } else if (/android/i.test(ua)) { this.href = $(this).data('android') } else { alert('很抱歉，您的手機目前無支援的軟體') } }); var $search = $('#search'); if ($search.length) { require(['colorbox', 'jquery-typeahead'], function () { var userSelection = false; $search.typeahead($.extend({}, $.defaultTypeaheadOption, { href: _req.base + 'stock/?id={{id}}', callback: { onInit: function (node) { $.post(_req.base + 'api/user-selection.ashx').done(function (data) { userSelection = data }) }, onClickBefore: function (node, a, item, e) { if (!$(e.target).hasClass('dialog')) { return } e.preventDefault(); $.colorbox({ iframe: true, fastIframe: false, href: e.target.href, width: '90%', height: '1' }) }, onLayoutBuiltBefore: function (node, query, result, resultHtmlList) { if (userSelection === false || !resultHtmlList) { return resultHtmlList } var li = resultHtmlList.find('li'); $.each(result, function (idx, r) { var a = $('<a class="dialog"/>'); if (~userSelection.indexOf(r.id)) { a.attr('href', _req.base + 'myesun/select-add.aspx?act=delete&id=' + r.id).text('移除自選') } else { a.attr('href', _req.base + 'myesun/select-add.aspx?id=' + r.id).text('加入自選') } li.eq(idx).append(a) }); return resultHtmlList } } })) }) } }) }) })();